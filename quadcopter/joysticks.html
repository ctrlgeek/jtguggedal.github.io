<!doctype html>
<html>
    <head>
        <title>Joystick testing</title>
        <meta charset="utf-8">
        <meta name="description" content="BLE quadcopter controller">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="css/joystick.css">
        <script src="js/func.js"></script>
        <script src="js/ble.js"></script>
        <script src="js/nipple.js"></script>
    </head>
    <body>
        <div id="joystick-container">
            <div id="joystick-left" class="joystick-wrapper">

            </div>

            <div id="joystick-right" class="joystick-wrapper">

            </div>
        </div>
        <div id="debug-containerLeft">
            <p id="debug-angleLeft">
                <b>Angle</b>: 0
            </p>
            <p id="debug-distanceLeft">
                <b>Distance</b>: 0
            </p>
            <p id="debug-outputLeft">
                <b>Output</b>: 0
            </p>
        </div>
        <div id="debug-containerRight">
            <p id="debug-angleRight">
                <b>Angle</b>: 0
            </p>
            <p id="debug-distanceRight">
                <b>Distance</b>: 0
            </p>
            <p id="debug-outputRight">
                <b>Output</b>: 0
            </p>
        </div>
        <script>
            var printPosition = 1;

            //**
            //     Joystick, based on the amazing nippleJS by @yoannmoinet: http://yoannmoinet.github.io/nipplejs/
            //**

            // Joystick left
            var joystickLeft = nipplejs.create({
                zone: document.getElementById('joystick-left'),
                mode: 'static',
                position: {left: '100px', top: '100px'},
                color: 'rgb(42, 115, 100)',
                size: 150,
                restOpacity: 0.9
            });
            joystickLeftPos = joystickLeft.position;


            joystickLeft.on('end', function(evt, data) {
                // Executes when joystick is released
                if(printPosition) {
                    select('#debug-angleLeft').innerHTML = '<b>Angle</b>: 0';
                    select('#debug-distanceLeft').innerHTML = '<b>Distance</b>: 0';
                    select('#debug-outputLeft').innerHTML = '<b>Output [%]</b>: 0';
                    //console.log(data);
                }
            }).on('move', function(evt, data) {

                // Executes on every new touch event from joystick

                var output = (data.distance / (joystickLeft.options.size / 2)) * 100;

                if(printPosition) {
                    select('#debug-angleLeft').innerHTML = '<b>Angle</b>: ' + data.angle.degree.toFixed(0);
                    select('#debug-distanceLeft').innerHTML = '<b>Distance</b>: ' + data.distance.toFixed(1);
                    select('#debug-outputLeft').innerHTML = '<b>Output [%]</b>: ' + output.toFixed(1) + ' %';
                    //console.log(data);
                }
            })

            // Joystick right
            var joystickRight = nipplejs.create({
                zone: document.getElementById('joystick-right'),
                mode: 'static',
                position: {right: '-40px', top: '100px'},
                color: 'rgb(42, 115, 100)',
                size: 150,
                restOpacity: 0.9
            });

            joystickRightPos = joystickRight.position;

            joystickRight.on('end', function(evt, data) {
                // Executes when joystick is released
                if(printPosition) {
                    select('#debug-angleRight').innerHTML = '<b>Angle</b>: 0';
                    select('#debug-distanceRight').innerHTML = '<b>Distance</b>: 0';
                    select('#debug-outputRight').innerHTML = '<b>Output [%]</b>: 0';
                    //console.log(data);
                }
            }).on('move', function(evt, data) {

                // Executes on every new touch event from joystick

                var output = (data.distance / (joystickRight.options.size / 2)) * 100;

                if(printPosition) {
                    select('#debug-angleRight').innerHTML = '<b>Angle</b>: ' + data.angle.degree.toFixed(0);
                    select('#debug-distanceRight').innerHTML = '<b>Distance</b>: ' + data.distance.toFixed(1);
                    select('#debug-outputRight').innerHTML = '<b>Output [%]</b>: ' + output.toFixed(1) + ' %';
                    //console.log(data);
                }
            })
        </script>
    </body>
</html>
