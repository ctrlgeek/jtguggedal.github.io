
<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Web Bluetooth</title>
    
    <style>
    	div {
    		margin: 10px;
    	}
    	
    	label {
    		display: inline-block;
    		width: 120px;
    	}
    	
    	input[type="text"] {
    		width: 220px;
    		padding: 5px;
    	}
    
    
    </style>
    <script>
      // If we're running on a real web server (as opposed to localhost, which is whitelisted),
      // then change the protocol to HTTPS.
      // See https://goo.gl/lq4gCo for an explanation as to why this is needed for some features.
      (function() {
        var isLocalhost = !!(window.location.hostname === 'localhost' ||
          // [::1] is the IPv6 localhost address.
          window.location.hostname === '[::1]' ||
          // 127.0.0.1/8 is considered localhost for IPv4.
          window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));
        if (window.location.protocol === 'http:' && !isLocalhost) {
          // Redirect to https: if we're currently using http: and we're not on localhost.
          window.location.protocol = 'https:';
        }
      })();

      window.addEventListener('error', function(error) {
        if (ChromeSamples && ChromeSamples.setStatus) {
          ChromeSamples.setStatus(error.message + ' (Nettleseren din støtter ikke Web Bluetooth.)');
          error.preventDefault();
        }
      });
    </script>

  </head>

  <body>
    <h1>LED-test</h1>
    <p>

<form>
  <div><label for="service">Service: </label><input id="service" type="text" list="services" autofocus placeholder="Bluetooth Service" value="00001523-1212-efde-1523-785feabcd123"></div>
  <div><label for="service">Characteristic: </label><input id="characteristic" type="text" list="characteristics" placeholder="Bluetooth Characteristic" value="00001525-1212-efde-1523-785feabcd123"></div>
  <div><button id="connect" >Koble til enhet</button></div>
</form>
  <div>
  	<button id="ledon" onclick="ledOn()">Slå LED PÅ</button>
  	<button id="ledoff" onclick="ledOff()">Slå LED AV</button>
  </div>



<script>
  var ChromeSamples = {
    log: function() {
      var line = Array.prototype.slice.call(arguments).map(function(argument) {
        return typeof argument === 'string' ? argument : JSON.stringify(argument);
      }).join(' ');

      document.querySelector('#log').textContent += line + '\n';
    },

    clearLog: function() {
      document.querySelector('#log').textContent = '';
    },

    setStatus: function(status) {
      document.querySelector('#status').textContent = status;
    },

    setContent: function(newContent) {
      var content = document.querySelector('#content');
      while(content.hasChildNodes()) {
        content.removeChild(content.lastChild);
      }
      content.appendChild(newContent);
    }
  };
</script>

<h3>Live Output</h3>
<div id="output" class="output">
  <div id="content"></div>
  <div id="status"></div>
  <pre id="log"></pre>
</div>



  
    
      <script>
      
      			// Søker etter enheter
      			
      			var myCharacteristic;
      			
      			function onFormSubmit() {
				  'use strict';

				  let serviceUuid = document.getElementById('service').value;
				  if (serviceUuid.startsWith('0x')) {
					serviceUuid = parseInt(serviceUuid, 16);
				  }

				  let characteristicUuid = document.getElementById('characteristic').value;
				  if (characteristicUuid.startsWith('0x')) {
					characteristicUuid = parseInt(characteristicUuid, 16);
				  }

				  log('Requesting Bluetooth Device...');
				  navigator.bluetooth.requestDevice({filters: [{services: [serviceUuid]}]})
				  .then(device => device.connectGATT())
				  .then(server => server.getPrimaryService(serviceUuid))
				  .then(service => service.getCharacteristic(characteristicUuid))
				  .then(characteristic => {
				  myCharacteristic = characteristic;
				  /*log('> Skrur LED på...');
					let ledValue = new Uint8Array([1]);
					return characteristic.writeValue(ledValue);*/
					})
				  .catch(error => {
					log('Argh! ' + error);
				  });
				}
				
				// Funksjon for å skru LED på
				
				function ledOn() {
					if(myCharacteristic) {
						log('> Skrur LED på...');
						let ledValue = new Uint8Array([1]);
						
						myCharacteristic.writeValue(ledValue);
						
						//return navigator.bluetooth.characteristic.writeValue(ledValue);
					}
				
				};
				
				// Funksjon for å skru LED av
				
				function ledOff() {
				
					if(myCharacteristic) {
						log('> Skrur LED av...');
						let ledValue = new Uint8Array([0]);
						
						myCharacteristic.writeValue(ledValue);
						
						//return navigator.bluetooth.characteristic.writeValue(ledValue);
					}
				
				};
				
   /*   function onButtonClick() {
  'use strict';

  log('Requesting Bluetooth Device...');
  navigator.bluetooth.requestDevice({filters: [{services: ['heart_rate']}]})
  .then(device => {
    log('> Found ' + device.name);
    log('Connecting to GATT Server...');
    return device.connectGATT();
  })
  .then(server => {
    log('Getting Heart Rate Service...');
    return server.getPrimaryService('heart_rate');
  })
  .then(service => {
    log('Getting Heart Rate Control Point Characteristic...');
    return service.getCharacteristic('heart_rate_control_point');
  })
  .then(characteristic => {
    log('Writing Heart Rate Control Point Characteristic...');

    // Writing 1 is the signal to reset energy expended.
    let ledValue = new Uint8Array([1]);
    return characteristic.writeValue(ledValue);
  })
  .then(() => {
    log('> Energy expended has been reset.');
  })
  .catch(error => {
    log('Argh! ' + error);
  });
}

*/

</script>
    
  


<script>
  document.querySelector('form').addEventListener('submit', function(event) {
    event.stopPropagation();
    event.preventDefault();

    if (!navigator.bluetooth) {
      ChromeSamples.setStatus('Web Bluetooth API is not available.\n' +
        'Please make sure the Web Bluetooth flag is enabled.');
    } else {
      ChromeSamples.clearLog();
      onFormSubmit();
    }
  });
  log = ChromeSamples.log;
</script>

    
  </body>
</html>
